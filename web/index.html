<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Job Order - Job Order Management</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-layout">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/dashboard.html" class="sidebar-logo">
                    <div class="sidebar-logo-icon">JO</div>
                    <div>
                        <div class="sidebar-logo-text">Job Orders</div>
                        <div class="sidebar-logo-subtitle">Management System</div>
                    </div>
                </a>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Main Menu</div>
                    <a href="/dashboard.html" class="nav-item">
                        <span class="nav-item-icon">
                            <svg viewBox="0 0 24 24" aria-hidden="true">
                                <path d="M3 10.5L12 3l9 7.5"></path>
                                <path d="M5 9.5V21h14V9.5"></path>
                            </svg>
                        </span>
                        <span>Dashboard</span>
                    </a>
                    <a href="/" class="nav-item active" id="newJobOrderNav">
                        <span class="nav-item-icon">
                            <svg viewBox="0 0 24 24" aria-hidden="true">
                                <path d="M12 5v14"></path>
                                <path d="M5 12h14"></path>
                                <rect x="4" y="4" width="16" height="16" rx="2"></rect>
                            </svg>
                        </span>
                        <span>New Job Order</span>
                    </a>
                    <a href="/reports.html" class="nav-item" id="reportsNav">
                        <span class="nav-item-icon">
                            <svg viewBox="0 0 24 24" aria-hidden="true">
                                <path d="M3 3v18h18"></path>
                                <path d="M7 15v3"></path>
                                <path d="M12 11v7"></path>
                                <path d="M17 7v11"></path>
                            </svg>
                        </span>
                        <span>Reports</span>
                    </a>
                    <a href="/staff-reports.html" class="nav-item">
                        <span class="nav-item-icon">
                            <svg viewBox="0 0 24 24" aria-hidden="true">
                                <path d="M16 11a4 4 0 1 0-8 0"></path>
                                <path d="M4 21a8 8 0 0 1 16 0"></path>
                            </svg>
                        </span>
                        <span>Staff Reports</span>
                    </a>
                    <a href="/pending-approvals.html" class="nav-item">
                        <span class="nav-item-icon">
                            <svg viewBox="0 0 24 24" aria-hidden="true">
                                <circle cx="12" cy="12" r="9"></circle>
                                <path d="M12 7v5l3 3"></path>
                            </svg>
                        </span>
                        <span id="navApprovalLabel">Pending Approvals</span>
                        <span class="nav-item-badge" id="approvalsBadge" style="display: none;">0</span>
                    </a>
                </div>

                <div class="nav-section" id="adminSection" style="display: none;">
                    <div class="nav-section-title">Administration</div>
                    <a href="/admin.html" class="nav-item">
                        <span class="nav-item-icon">
                            <svg viewBox="0 0 24 24" aria-hidden="true">
                                <path d="M12 3l7 4v5c0 5-3.5 9-7 9s-7-4-7-9V7l7-4z"></path>
                                <path d="M9 12l2 2 4-4"></path>
                            </svg>
                        </span>
                        <span>Signatures</span>
                        <span class="nav-item-badge" id="pendingBadge" style="display: none;">0</span>
                    </a>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="sidebar-user" id="sidebarUser">
                    <div class="sidebar-user-avatar" id="sidebarAvatar">U</div>
                    <div class="sidebar-user-info">
                        <div class="sidebar-user-name" id="sidebarUserName">User</div>
                        <div class="sidebar-user-role" id="sidebarUserRole">Staff</div>
                    </div>
                </div>
                <button class="btn btn-ghost btn-full mt-2" id="settingsBtn" style="justify-content: flex-start; gap: 12px;">
                    <span class="sidebar-action-icon">
                        <svg viewBox="0 0 24 24" aria-hidden="true">
                            <path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z"></path>
                            <path d="M19.4 15a1 1 0 0 0 .2 1.1l1.1 1.1-2 3.4-1.5-.6a1 1 0 0 0-1 .1l-1.4.8-1.6-2.6a1 1 0 0 0-.9-.5h-2.6a1 1 0 0 0-.9.5l-1.6 2.6-1.4-.8a1 1 0 0 0-1-.1l-1.5.6-2-3.4 1.1-1.1a1 1 0 0 0 .2-1.1l-.6-1.5a1 1 0 0 0-.8-.6H3.5V8.1h1.6a1 1 0 0 0 .8-.6l.6-1.5a1 1 0 0 0-.2-1.1L5.2 3.8l2-3.4 1.5.6a1 1 0 0 0 1-.1l1.4-.8L12 2.7l1.6-2.6 1.4.8a1 1 0 0 0 1 .1l1.5-.6 2 3.4-1.1 1.1a1 1 0 0 0-.2 1.1l.6 1.5a1 1 0 0 0 .8.6h1.6v4.8h-1.6a1 1 0 0 0-.8.6z"></path>
                        </svg>
                    </span>
                    <span>Settings</span>
                </button>
                <button class="btn btn-ghost btn-full mt-2" id="logoutBtn" style="justify-content: flex-start; gap: 12px;">
                    <span class="sidebar-action-icon">
                        <svg viewBox="0 0 24 24" aria-hidden="true">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                            <path d="M16 17l5-5-5-5"></path>
                            <path d="M21 12H9"></path>
                        </svg>
                    </span>
                    <span>Logout</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Bar -->
            <header class="top-bar">
                <div class="top-bar-left">
                    <button class="icon-btn mobile-menu-toggle" id="menuToggle" style="display: none;">Menu</button>
                    <div>
                        <h1 class="page-title">New Job Order</h1>
                        <div class="breadcrumb">
                            <span>Home</span>
                            <span class="breadcrumb-separator">/</span>
                            <span>New Job Order</span>
                        </div>
                    </div>
                </div>
                <div class="top-bar-right">
                    <div class="job-badge">
                        <span class="job-badge-label">Job #</span>
                        <span class="job-badge-number" id="job-number-display">...</span>
                    </div>
                    <div class="status-indicator ready" id="statusIndicator">
                        <span class="status-dot"></span>
                        <span id="statusText">Ready</span>
                    </div>
                </div>
            </header>

            <!-- Page Content -->
            <div class="page-content">
                <div class="alert alert-info mb-4" id="staffNotice" style="display: none;">
                    <div class="alert-icon"></div>
                    <div class="alert-content">
                        <div class="alert-title">Signature Requests Only</div>
                        <div class="alert-message">
                            Your account can review and accept signature requests, but cannot generate reports.
                            Please visit <a href="/pending-approvals.html">Pending Approvals</a> to approve signatures.
                        </div>
                    </div>
                </div>
                <!-- Form Container -->
                <form id="jobForm" class="form-container">
                    <div class="grid grid-cols-3 gap-4" style="grid-template-columns: 2fr 1fr;">
                        <!-- Main Form Column -->
                        <div class="flex flex-col gap-4">
                            <!-- General Information Card -->
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">
                                        General Information
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label class="form-label">Date of Request <span class="text-error">*</span></label>
                                            <input type="date" class="form-input" name="main_date" id="main_date" required>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Work Type</label>
                                            <div class="form-radio-group">
                                                <label class="form-radio">
                                                    <input type="radio" name="work_type" value="Site" checked>
                                                    <span> Site</span>
                                                </label>
                                                <label class="form-radio">
                                                    <input type="radio" name="work_type" value="Office">
                                                    <span> Office</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group mb-0">
                                        <label class="form-label">Department</label>
                                        <select class="form-select" name="department" id="department">
                                            <option value="servies">Services</option>
                                            <option value="Design">Design</option>
                                            <option value="project">Project</option>
                                            <option value="QS">QS</option>
                                            <option value="Mosque Maint.">Mosque Maint.</option>
                                            <option value="Investment Maint.">Investment Maint.</option>
                                            <option value="Cemetry">Cemetery</option>
                                            <option value="MEP">MEP</option>
                                            <option value="Others">Others</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Work Details Card -->
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">
                                        Work Details
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="form-group">
                                        <label class="form-label">Objective Name</label>
                                        <input type="text" class="form-input" name="objective" placeholder="Enter primary objective...">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Work Description</label>
                                        <textarea class="form-textarea" name="description" rows="4" placeholder="Detailed description of the work to be done..."></textarea>
                                    </div>

                                    <!-- Duration Section -->
                                    <div class="duration-section">
                                        <div class="duration-header">Estimated Working Time</div>

                                        <div class="duration-row">
                                            <span class="duration-label">Days:</span>
                                            <div class="duration-options">
                                                <label class="circle-radio"><input type="radio" name="duration_days" value="1"><span>1</span></label>
                                                <label class="circle-radio"><input type="radio" name="duration_days" value="2"><span>2</span></label>
                                                <label class="circle-radio"><input type="radio" name="duration_days" value="3"><span>3</span></label>
                                                <label class="circle-radio"><input type="radio" name="duration_days" value="4"><span>4</span></label>
                                                <label class="circle-radio"><input type="radio" name="duration_days" value="5"><span>5</span></label>
                                            </div>
                                        </div>

                                        <div class="duration-row">
                                            <span class="duration-label">Weeks:</span>
                                            <div class="duration-options">
                                                <label class="circle-radio"><input type="radio" name="duration_weeks" value="1"><span>1</span></label>
                                                <label class="circle-radio"><input type="radio" name="duration_weeks" value="2"><span>2</span></label>
                                                <label class="circle-radio"><input type="radio" name="duration_weeks" value="3"><span>3</span></label>
                                                <label class="circle-radio"><input type="radio" name="duration_weeks" value="4"><span>4</span></label>
                                            </div>
                                        </div>

                                        <div class="duration-row">
                                            <span class="duration-label">Months:</span>
                                            <div class="duration-options">
                                                <label class="circle-radio"><input type="radio" name="duration_months" value="2"><span>2</span></label>
                                                <label class="circle-radio"><input type="radio" name="duration_months" value="4"><span>4</span></label>
                                                <label class="circle-radio"><input type="radio" name="duration_months" value="6"><span>6</span></label>
                                                <label class="circle-radio"><input type="radio" name="duration_months" value="8"><span>8</span></label>
                                                <label class="circle-radio"><input type="radio" name="duration_months" value="10"><span>10</span></label>
                                                <label class="circle-radio"><input type="radio" name="duration_months" value="12"><span>12</span></label>
                                            </div>
                                        </div>

                                        <div class="duration-row">
                                            <span class="duration-label">Years:</span>
                                            <div class="duration-options">
                                                <label class="circle-radio"><input type="radio" name="duration_years" value="1"><span>1</span></label>
                                                <label class="circle-radio"><input type="radio" name="duration_years" value="2"><span>2</span></label>
                                                <label class="circle-radio"><input type="radio" name="duration_years" value="3"><span>3</span></label>
                                                <label class="circle-radio"><input type="radio" name="duration_years" value="4"><span>4</span></label>
                                                <label class="circle-radio"><input type="radio" name="duration_years" value="5"><span>5</span></label>
                                            </div>
                                        </div>

                                        <button type="button" class="duration-clear" onclick="clearDuration()">Clear Selection</button>
                                    </div>

                                    <div class="form-group mt-4 mb-0">
                                        <label class="form-label">Additional Notes <span class="form-label-optional">(Optional)</span></label>
                                        <textarea class="form-textarea" name="note" rows="2" placeholder="Special instructions or notes..."></textarea>
                                    </div>
                                </div>
                            </div>

                            <!-- Schedule Card -->
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">
                                        Schedule
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="form-row mb-0">
                                        <div class="form-group mb-0">
                                            <label class="form-label">Starting Date</label>
                                            <input type="date" class="form-input" name="start_date" id="start_date">
                                        </div>
                                        <div class="form-group mb-0">
                                            <label class="form-label">Ending Date</label>
                                            <input type="date" class="form-input" name="end_date" id="end_date">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Attachments Card -->
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">
                                        Attachments <span class="form-label-optional">(Optional)</span>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="form-group mb-0">
                                        <label class="form-label">Upload Files</label>
                                        <div class="attachment-dropzone" id="attachmentDropzone">
                                            <input type="file" name="attachments" id="attachmentInput" multiple accept="image/*,.pdf,.doc,.docx,.xls,.xlsx">
                                            <div class="dropzone-content">
                                                <svg width="40" height="40" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                                                </svg>
                                                <p>Drag & drop files here or <span class="dropzone-link">browse</span></p>
                                                <small>Supports: Images, PDF, Word, Excel</small>
                                            </div>
                                        </div>
                                        <div class="attachment-list" id="attachmentList"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Side Column -->
                        <div class="flex flex-col gap-4">
                            <!-- Authorization Card -->
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">
                                        Authorization
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="form-group">
                                        <label class="form-label">Engineer Name</label>
                                        <input type="text" class="form-input" name="engineer" placeholder="Assigned engineer...">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Head of Section</label>
                                        <input type="text" class="form-input" name="head_section" placeholder="Section head...">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Admin Signature</label>
                                        <select class="form-select" name="admin_signature" id="admin_signature">
                                            <option value="">-- Select Signature --</option>
                                        </select>
                                        <div class="signature-preview-small" id="adminSigPreview"></div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Staff Signature</label>
                                        <select class="form-select" name="staff_signature" id="staff_signature">
                                            <option value="">-- Select Signature --</option>
                                        </select>
                                        <div class="signature-preview-small" id="staffSigPreview"></div>
                                    </div>
                                    <div class="form-group mb-0">
                                        <label class="form-label">Remarks <span class="form-label-optional">(Optional)</span></label>
                                        <textarea class="form-textarea" name="remarks" rows="3" placeholder="Final comments..."></textarea>
                                    </div>
                                </div>
                            </div>

                            <!-- Quick Info Card -->
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">
                                        Quick Info
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="alert alert-info" style="margin-bottom: 0;">
                                        <div class="alert-content">
                                            <div class="alert-title">Ready to Generate</div>
                                            <div class="alert-message">Fill in the required fields and click Generate to create your job order report.</div>
                                        </div>
                                    </div>
                                    <div class="mt-4">
                                        <div class="flex justify-between text-sm mb-2">
                                            <span class="text-secondary">Current Date:</span>
                                            <span class="font-semibold" id="currentDate">-</span>
                                        </div>
                                        <div class="flex justify-between text-sm">
                                            <span class="text-secondary">Next Job #:</span>
                                            <span class="font-semibold" id="currentJobNo">-</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Actions Card -->
                            <div class="card">
                                <div class="card-body">
                                    <button type="submit" class="btn btn-primary btn-lg btn-full mb-4" id="submitBtn">
                                        Generate Report
                                    </button>
                                    <button type="button" class="btn btn-secondary btn-full" onclick="resetForm()">
                                        Clear Form
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </main>
    </div>

    <!-- Login Modal -->
    <div class="modal-overlay" id="loginModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Login Required</h3>
            </div>
            <div class="modal-body">
                <p class="text-secondary mb-4">Please sign in with your Active Directory credentials</p>
                <form id="loginForm">
                    <div class="form-group">
                        <label class="form-label">Username or Email</label>
                        <input type="text" class="form-input" id="loginUsername" placeholder="Enter your username..." required autofocus>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-input" id="loginPassword" placeholder="Enter your password..." required>
                    </div>
                    <div class="alert alert-error" id="loginError" style="display: none;"></div>
                    <button type="submit" class="btn btn-primary btn-full btn-lg" id="loginBtn">Sign In</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal-overlay" id="successModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Success!</h3>
                <button class="modal-close" id="closeSuccessModal">&times;</button>
            </div>
            <div class="modal-body text-center">
                <div style="font-size: 64px; margin-bottom: 16px;"></div>
                <h4 class="font-semibold mb-2">Job Order Created!</h4>
                <p class="text-secondary mb-4" id="successMessage">Your job order has been generated successfully.</p>
                <div class="flex gap-4">
                    <a href="/reports.html" class="btn btn-secondary btn-full">View Reports</a>
                    <button class="btn btn-primary btn-full" id="createAnotherBtn">Create Another</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal-overlay" id="settingsModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Settings</h3>
                <button class="modal-close" id="closeSettingsModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="settingsForm">
                    <div class="form-group">
                        <label class="form-label">Save Reports To</label>
                        <div class="flex gap-2">
                            <input type="text" class="form-input" id="savePathInput" placeholder="e.g., \\\\server\\share\\Reports or C:\\Reports">
                            <button type="button" class="btn btn-secondary" id="browseSavePathBtn">Browse</button>
                        </div>
                        <input type="file" id="savePathPicker" webkitdirectory directory style="display: none;">
                        <small class="text-secondary" style="display: block; margin-top: 8px;">
                            Enter a network path or local folder where generated reports will be saved.
                            Leave empty to use the default server location.
                        </small>
                    </div>
                    <div class="flex gap-4 mt-4">
                        <button type="button" class="btn btn-secondary btn-full" id="cancelSettingsBtn">Cancel</button>
                        <button type="submit" class="btn btn-primary btn-full">Save Settings</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script src="app.js"></script>
</body>
</html>
